\documentclass[10pt,a4paper]{article}

\usepackage[a-1b]{pdfx} %high quality pdf
\usepackage{datetime}
\usepackage{numprint}
\usepackage{palatino}
\usepackage{authblk}
\usepackage[margin=0.75in]{geometry}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{titlesec}
\usepackage{listings}

\pdfgentounicode=1

\setlength{\parindent}{2em}
%\setlength{\parskip}{1em}
\renewcommand{\baselinestretch}{1.1}

\begin{document}

\nplpadding{2}
\newdateformat{isodate}{\THEYEAR-\numprint{\THEMONTH}-\numprint{\THEDAY}}

\title{Penetration Testing Report for Ex0d0\\ \large{\textit{Codename: `PatronumIsBreached`}}}
\author{Naman Arora\\\small{Pr0b3 LLC}}
\date{\isodate\today}

\maketitle
\section{Finding: Unauthenticated Access to \textit{NT Authority\textbackslash System}}
\subsubsection{Risk Rating: 8.0}
The access to \textit{NT Authority\textbackslash System} on \textit{`PATRONUM`@10.30.0.97} via \textit{Remote Desktop}.
\subsubsection{Vulnerability Description}
If an attacker can reach the \textit{`PATRONUM`@10.30.0.97} using the \textit{Remote Desktop}, they can leverage the \textit{Sticky Keys} (Tapping \textit{`Shift`} 5 times) to access the \textit{`sethc.exe`} which in this case is replaced by \textit{`cmd.exe`}.
The Command prompt is run by the \textit{NT Authority\textbackslash System} and thus, the attacker can add a new local user with administrative privileges.
\subsubsection{Confirmation Method}
The Vulnerability can be confirmed by \textbf{pressing \textit{`Shift`} key 5 times in quick succession} while logging into \textit{`PATRONUM`@10.30.0.97} using the \textit{Remote Desktop} (Fig. \ref{cmd}).
\subsubsection{Remediation}
The vulnerability can be remedied by pointing the \textit{`sthe.exe`} to the correct binary and \textbf{NOT} \textit{`cmd.exe`} (Fig \ref{sethc})

\begin{figure}[h!]
	\includegraphics[width=\textwidth]{pics/cmd.png}
	\caption{Command Prompt with \textit{NT Authority\textbackslash System}}
	\label{cmd}
\end{figure}
\begin{figure}[h!]
	\includegraphics[width=\textwidth]{pics/sethc.png}
	\caption{Renamed \textit{`sethc.exe`}, actually is \textit{`cmd.exe`}}
	\label{sethc}
\end{figure}
\newpage
\section{Attack Narrative}
The vulnerability is not a \textit{Critical 10} since the host \textit{`PATRONUM`@10.30.0.97} is not accessible via outside network.
On forwarding the port 3389 on \textit{`PATRONUM`@10.30.0.97} to \textit{`innerouter`@172.30.0.3}, the host is still inaccessible due to restricted RDP access policies.

\begin{figure}[h!]
	\includegraphics[width=\textwidth]{pics/venom.png}
	\caption{\textit{RDP} on \textit{`kali`@3388} after \textit{`portfwd`} from \textit{`PATRONUM`@10.30.0.97} using \textit{Meterpreter session}}
	\label{venom}
\end{figure}
\begin{figure}[h!]
	\includegraphics[width=\textwidth]{pics/add_brian.png}
	\caption{Add a new user to \textit{`PATRONUM`@10.30.0.97} with administrator privileges}
	\label{add_john}
\end{figure}
The attacker can leverage access to host \textit{`HERD`@10.30.0.98} to gain access to \textit{`PATRONUM`@10.30.0.97} using \textit{RDP}.
One way this can be done is via delivering a \textit{reverse\_tcp meterpreter} binary to \textit{`HERD`@10.30.0.98} which then can be transfered to \textit{`PATRONUM`@10.30.0.97} (Fig. \ref{venom}).
Once the access is established, the attacker can give any wrong credentials in order to access the login screen of \textit{`PATRONUM`@10.30.0.97}.
Once on login screen, pressing \textit{`Shift`} key 5 times in quick succession gives access to command prompt as the user \textit{NT Authority\textbackslash System} (Fig. \ref{cmd}).
The attacker can then add a new user using the command,
\begin{lstlisting}[language=bash]
	>> net user brian Passwd123 /add
\end{lstlisting}
and eventually give the new user administrative privileges using,
\begin{lstlisting}[language=bash]
	>> net localgroup administrators brian /add
\end{lstlisting}
then, login as the new user to gain access with administrative privileges (Fig. \ref{add_john}).

Once inside the system, the attacker may gain access to all the files of all the users and if some of them have access restrictions (ownership/permission), they can be solved using \textit{`takeown`} and/or \textit{`icacls`} commands.

\end{document}
